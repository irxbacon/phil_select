{% extends "base.html" %}

{% block title %}Crew Preferences - Philmont Trek Selection{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="fas fa-cog"></i> Crew Preferences</h2>
        <p class="lead">Set your crew's preferences for trek selection. These preferences will influence how itineraries are scored and ranked.</p>
    </div>
</div>



<form method="POST">
    <div class="row">
        <!-- Crew Information -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-users"></i> Crew Information
                </div>
                <div class="card-body">
                    {% if crew %}
                        <p><strong>Crew Name:</strong> {{ crew.crew_name or 'Sample Crew' }}</p>
                        <p><strong>Crew Size:</strong> {{ crew_members|length }} members
                        {% if avg_skill_score %}
                            | <strong>Avg Skill:</strong> {{ avg_skill_score }}
                        {% endif %}
                        </p>
                        <p><strong>Members:</strong></p>
                        {% if crew_members %}
                        <div class="list-group list-group-flush">
                            {% for member in crew_members %}
                            <div class="list-group-item d-flex justify-content-between align-items-center p-2">
                                <span>
                                    <i class="fas fa-user text-primary"></i> 
                                    {{ member.name or ('Crewmember ' + member.member_number|string) }}
                                    {% if member.age %}
                                        <small class="text-muted">(age {{ member.age }})</small>
                                    {% endif %}
                                </span>
                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                        onclick="deleteMember({{ member.id }}, '{{ member.name or ('Crewmember ' + member.member_number|string) }}')"
                                        title="Delete this crew member">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-3 d-flex gap-2">
                            <button type="button" class="btn btn-sm btn-success" 
                                    data-bs-toggle="modal" data-bs-target="#addMemberModal"
                                    title="Add a new crew member">
                                <i class="fas fa-user-plus"></i> Add Member
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-warning" 
                                    onclick="deleteAllMembers()"
                                    title="Delete all crew members">
                                <i class="fas fa-trash-alt"></i> Delete All Members
                            </button>
                        </div>
                        {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> No crew members found.
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-success" 
                                    data-bs-toggle="modal" data-bs-target="#addMemberModal"
                                    title="Add a new crew member">
                                <i class="fas fa-user-plus"></i> Add Member
                            </button>
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Trek Type Selection -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-calendar-alt"></i> Trek Type
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="trek_type" class="form-label">
                            <strong>Select Trek Duration:</strong>
                        </label>
                        <select class="form-select" id="trek_type" name="trek_type" onchange="handleTrekTypeChange()">
                            {% for trek_type in available_trek_types %}
                                <option value="{{ trek_type }}" {% if (preferences and preferences.trek_type == trek_type) or (not preferences and trek_type == '12-day') %}selected{% endif %}>
                                    {% if trek_type == '12-day' %}
                                        12-Day Treks (Traditional)
                                    {% elif trek_type == '9-day' %}
                                        9-Day Treks (Shorter Duration)
                                    {% elif trek_type == '7-day' %}
                                        7-Day Treks (Weekend Adventure)
                                    {% elif trek_type == 'Cavalcade' %}
                                        Cavalcade (Horseback Adventure)
                                    {% else %}
                                        {{ trek_type }}
                                    {% endif %}
                                </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">
                            <small>Only trek types with available itinerary data are shown. Currently available: 
                            {% for trek_type in available_trek_types %}{{ trek_type }}{% if not loop.last %}, {% endif %}{% endfor %}.
                            </small>
                        </div>
                        {% if preferences and preferences.trek_type not in available_trek_types %}
                        <div class="alert alert-info mt-2">
                            <i class="fas fa-info-circle"></i> 
                            Your previously selected trek type "{{ preferences.trek_type }}" is not currently available. 
                            Please select from the available options above.
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Regional Preferences -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-marked-alt"></i> Regional Preferences
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="area_important" name="area_important"
                               {% if preferences and preferences.area_important %}checked{% endif %}>
                        <label class="form-check-label" for="area_important">
                            <strong>Area is important to us</strong>
                        </label>
                    </div>
                    
                    <div id="area_rankings" {% if not preferences or not preferences.area_important %}style="display:none;"{% endif %}>
                        <p><small>Rank each area (1=most preferred, 4=least preferred):</small></p>
                        
                        <div class="row mb-2">
                            <div class="col-8">South Country:</div>
                            <div class="col-4">
                                <select class="form-select form-select-sm" name="area_rank_south">
                                    <option value="">-</option>
                                    {% for i in range(1, 5) %}
                                    <option value="{{ i }}" {% if preferences and preferences.area_rank_south == i %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-2">
                            <div class="col-8">Central Country:</div>
                            <div class="col-4">
                                <select class="form-select form-select-sm" name="area_rank_central">
                                    <option value="">-</option>
                                    {% for i in range(1, 5) %}
                                    <option value="{{ i }}" {% if preferences and preferences.area_rank_central == i %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-2">
                            <div class="col-8">North Country:</div>
                            <div class="col-4">
                                <select class="form-select form-select-sm" name="area_rank_north">
                                    <option value="">-</option>
                                    {% for i in range(1, 5) %}
                                    <option value="{{ i }}" {% if preferences and preferences.area_rank_north == i %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-2">
                            <div class="col-8">Valle Vidal:</div>
                            <div class="col-4">
                                <select class="form-select form-select-sm" name="area_rank_valle_vidal">
                                    <option value="">-</option>
                                    {% for i in range(1, 5) %}
                                    <option value="{{ i }}" {% if preferences and preferences.area_rank_valle_vidal == i %}selected{% endif %}>{{ i }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Difficulty Preferences -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-mountain"></i> Difficulty Preferences
                </div>
                <div class="card-body">
                    <p><small>Select which difficulty levels your crew can handle:</small></p>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="difficulty_challenging" name="difficulty_challenging"
                               {% if not preferences or preferences.difficulty_challenging %}checked{% endif %}>
                        <label class="form-check-label" for="difficulty_challenging">
                            <span class="badge difficulty-C">C</span> Challenging
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="difficulty_rugged" name="difficulty_rugged"
                               {% if not preferences or preferences.difficulty_rugged %}checked{% endif %}>
                        <label class="form-check-label" for="difficulty_rugged">
                            <span class="badge difficulty-R">R</span> Rugged
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="difficulty_strenuous" name="difficulty_strenuous"
                               {% if not preferences or preferences.difficulty_strenuous %}checked{% endif %}>
                        <label class="form-check-label" for="difficulty_strenuous">
                            <span class="badge difficulty-S">S</span> Strenuous
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="difficulty_super_strenuous" name="difficulty_super_strenuous"
                               {% if not preferences or preferences.difficulty_super_strenuous %}checked{% endif %}>
                        <label class="form-check-label" for="difficulty_super_strenuous">
                            <span class="badge difficulty-SS">SS</span> Super Strenuous
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Altitude Preferences -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-arrow-up"></i> Altitude Factors
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="max_altitude_important" name="max_altitude_important"
                               {% if preferences and preferences.max_altitude_important %}checked{% endif %}>
                        <label class="form-check-label" for="max_altitude_important">
                            <strong>Highest camp elevation</strong>
                        </label>
                        <div class="form-text">
                            <small>Score based on maximum camp elevation (20-130 points based on altitude).</small>
                        </div>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="total_elevation_gain_important" name="total_elevation_gain_important"
                               {% if preferences and preferences.total_elevation_gain_important %}checked{% endif %}>
                        <label class="form-check-label" for="total_elevation_gain_important">
                            <strong>Overall elevation change</strong>
                        </label>
                        <div class="form-text">
                            <small>Score based on total elevation gain throughout trek (40-100 points based on gain).</small>
                        </div>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="altitude_change_important" name="altitude_change_important"
                               {% if preferences and preferences.altitude_change_important %}checked{% endif %}>
                        <label class="form-check-label" for="altitude_change_important">
                            <strong>Average daily change</strong>
                        </label>
                        <div class="form-text">
                            <small>Score based on average daily elevation change (100-300 points based on daily change).</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Peak Climbing -->
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-flag-checkered"></i> Peak Climbing Interests
                </div>
                <div class="card-body">
                    <p><small>Select peaks you're interested in climbing:</small></p>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_baldy" name="climb_baldy"
                               {% if preferences and preferences.climb_baldy %}checked{% endif %}>
                        <label class="form-check-label" for="climb_baldy">
                            <i class="fas fa-mountain text-primary"></i> Baldy Mountain (12,441 ft)
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_phillips" name="climb_phillips"
                               {% if preferences and preferences.climb_phillips %}checked{% endif %}>
                        <label class="form-check-label" for="climb_phillips">
                            <i class="fas fa-mountain text-success"></i> Mount Phillips (11,742 ft)
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_tooth" name="climb_tooth"
                               {% if preferences and preferences.climb_tooth %}checked{% endif %}>
                        <label class="form-check-label" for="climb_tooth">
                            <i class="fas fa-mountain text-warning"></i> Tooth of Time (9,003 ft)
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_inspiration_point" name="climb_inspiration_point"
                               {% if preferences and preferences.climb_inspiration_point %}checked{% endif %}>
                        <label class="form-check-label" for="climb_inspiration_point">
                            <i class="fas fa-mountain text-info"></i> Inspiration Point
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_trail_peak" name="climb_trail_peak"
                               {% if preferences and preferences.climb_trail_peak %}checked{% endif %}>
                        <label class="form-check-label" for="climb_trail_peak">
                            <i class="fas fa-mountain text-secondary"></i> Trail Peak
                        </label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="climb_others" name="climb_others"
                               {% if preferences and preferences.climb_others %}checked{% endif %}>
                        <label class="form-check-label" for="climb_others">
                            <i class="fas fa-mountain text-danger"></i> Others (Mountaineering)
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Hiking Preferences -->
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-hiking"></i> Hiking Preferences
                </div>
                <div class="card-body">
                    <p><small>Select your crew's hiking preferences (500 points each when matched):</small></p>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="hike_in_preference" name="hike_in_preference"
                                       {% if not preferences or preferences.hike_in_preference %}checked{% endif %}>
                                <label class="form-check-label" for="hike_in_preference">
                                    <i class="fas fa-hiking text-success"></i> <strong>Prefer to hike in to start</strong>
                                </label>
                                <div class="form-text">
                                    Prefer itineraries that start with a hike rather than bus transportation to the first camp.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="hike_out_preference" name="hike_out_preference"
                                       {% if not preferences or preferences.hike_out_preference %}checked{% endif %}>
                                <label class="form-check-label" for="hike_out_preference">
                                    <i class="fas fa-hiking text-info"></i> <strong>Prefer to hike out at the end</strong>
                                </label>
                                <div class="form-text">
                                    Prefer itineraries that end with a hike rather than bus transportation from the last camp.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Camp and Layover Preferences -->
        <div class="col-md-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-campground"></i> Camp & Layover Preferences
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-3">
                                <label for="max_dry_camps" class="form-label">
                                    <i class="fas fa-tint text-warning"></i> <strong>Maximum Dry Camps</strong>
                                </label>
                                <select class="form-control" id="max_dry_camps" name="max_dry_camps">
                                    <option value="">No limit</option>
                                    <option value="0" {% if preferences and preferences.max_dry_camps == 0 %}selected{% endif %}>0 (Avoid all dry camps)</option>
                                    <option value="1" {% if preferences and preferences.max_dry_camps == 1 %}selected{% endif %}>1 dry camp maximum</option>
                                    <option value="2" {% if preferences and preferences.max_dry_camps == 2 %}selected{% endif %}>2 dry camps maximum</option>
                                    <option value="3" {% if preferences and preferences.max_dry_camps == 3 %}selected{% endif %}>3 dry camps maximum</option>
                                    <option value="4" {% if preferences and preferences.max_dry_camps == 4 %}selected{% endif %}>4 dry camps maximum</option>
                                    <option value="5" {% if preferences and preferences.max_dry_camps == 5 %}selected{% endif %}>5 dry camps maximum</option>
                                </select>
                                <div class="form-text">
                                    Set the maximum number of camps without water sources your crew is willing to accept.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check mb-3" style="margin-top: 2rem;">
                                <input class="form-check-input" type="checkbox" id="showers_required" name="showers_required"
                                       {% if preferences and preferences.showers_required %}checked{% endif %}>
                                <label class="form-check-label" for="showers_required">
                                    <i class="fas fa-shower text-primary"></i> <strong>Showers Required</strong>
                                </label>
                                <div class="form-text">
                                    Prefer itineraries that include camps with shower facilities.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check mb-3" style="margin-top: 2rem;">
                                <input class="form-check-input" type="checkbox" id="layovers_required" name="layovers_required"
                                       {% if preferences and preferences.layovers_required %}checked{% endif %}>
                                <label class="form-check-label" for="layovers_required">
                                    <i class="fas fa-calendar-alt text-success"></i> <strong>Layovers Required</strong>
                                </label>
                                <div class="form-text">
                                    Prefer itineraries that include layover days for rest and activities.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    <h6><i class="fas fa-utensils text-warning"></i> Food Resupply Preferences</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="prefer_frequent_resupply" name="prefer_frequent_resupply"
                                       {% if preferences and preferences.prefer_frequent_resupply %}checked{% endif %}>
                                <label class="form-check-label" for="prefer_frequent_resupply">
                                    <i class="fas fa-truck text-info"></i> <strong>Prefer Lower Initial Food Load</strong>
                                </label>
                                <div class="form-text">
                                    Prefer less food carried out from base (lighter packs to start with).
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="prefer_self_sufficient" name="prefer_self_sufficient"
                                       {% if preferences and preferences.prefer_self_sufficient %}checked{% endif %}>
                                <label class="form-check-label" for="prefer_self_sufficient">
                                    <i class="fas fa-backpack text-success"></i> <strong>Less Frequent Food Resupply</strong>
                                </label>
                                <div class="form-text">
                                    Prefer longer periods between resupply (fewer stops, but larger food resupplies).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-star"></i> Program Importance
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="programs_important" name="programs_important"
                               {% if preferences and preferences.programs_important %}checked{% endif %}>
                        <label class="form-check-label" for="programs_important">
                            <strong>Activity programs are very important to our crew</strong>
                        </label>
                        <div class="form-text">
                            When checked, program scores will have increased weight in the final calculations.
                        </div>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="adult_program_weight_enabled" name="adult_program_weight_enabled"
                               {% if preferences and preferences.adult_program_weight_enabled %}checked{% endif %}>
                        <label class="form-check-label" for="adult_program_weight_enabled">
                            <strong>Apply partial weight to adult program preferences (age 21+)</strong>
                        </label>
                        <div class="form-text">
                            When checked, program scores from adults will be weighted by the percentage below.
                        </div>
                    </div>
                    
                    <div id="adult_weight_settings" {% if not preferences or not preferences.adult_program_weight_enabled %}style="display:none;"{% endif %}>
                        <div class="mb-3">
                            <label for="adult_program_weight_percent" class="form-label">Adult program weight percentage (0-100%):</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="adult_program_weight_percent" name="adult_program_weight_percent" 
                                       value="{{ preferences.adult_program_weight_percent if preferences and preferences.adult_program_weight_percent else 50 }}" 
                                       min="0" max="100" step="1">
                                <span class="input-group-text">%</span>
                            </div>
                            <div class="form-text">
                                Set the percentage weight to apply to program scores from crew members age 21 and older. 
                                For example, 50% means adult preferences count for half as much as youth preferences.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Save Preferences
                </button>
                <a href="{{ url_for('scores') }}" class="btn btn-outline-primary btn-lg">
                    Next: Score Programs <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</form>

<!-- Add Member Modal -->
<div class="modal fade" id="addMemberModal" tabindex="-1" aria-labelledby="addMemberModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMemberModalLabel">
                    <i class="fas fa-user-plus"></i> Add Crew Member
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_member') }}" id="addMemberForm">
                <div class="modal-body">
                    <input type="hidden" name="crew_id" value="{{ crew.id if crew else '' }}">
                    <input type="hidden" name="redirect_to" value="preferences">
                    
                    <div class="mb-3">
                        <label for="member_name" class="form-label">Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="member_name" name="name" required>
                    </div>
                    

                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="member_age" class="form-label">Age</label>
                                <input type="number" class="form-control" id="member_age" name="age" min="10">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="member_skill_level" class="form-label">Skill Level</label>
                                <select class="form-select" id="member_skill_level" name="skill_level">
                                    <option value="1">1 - Beginner</option>
                                    <option value="2">2 - Novice</option>
                                    <option value="3" selected>3 - Intermediate</option>
                                    <option value="4">4 - Advanced</option>
                                    <option value="5">5 - Expert</option>
                                </select>
                                <div class="form-text">Hiking and outdoor experience level</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-user-plus"></i> Add Member
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Show/hide area rankings based on importance checkbox
    document.getElementById('area_important').addEventListener('change', function() {
        const rankings = document.getElementById('area_rankings');
        rankings.style.display = this.checked ? 'block' : 'none';
    });

    // Show/hide adult program weight settings based on checkbox
    document.getElementById('adult_program_weight_enabled').addEventListener('change', function() {
        const settings = document.getElementById('adult_weight_settings');
        settings.style.display = this.checked ? 'block' : 'none';
    });

    // Delete individual crew member
    function deleteMember(memberId, memberName) {
        if (confirm(`Are you sure you want to delete ${memberName}? This will also delete all their program scores.`)) {
            // Create a form to submit the delete request
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("delete_member") }}';
            
            const memberIdInput = document.createElement('input');
            memberIdInput.type = 'hidden';
            memberIdInput.name = 'member_id';
            memberIdInput.value = memberId;
            
            const crewIdInput = document.createElement('input');
            crewIdInput.type = 'hidden';
            crewIdInput.name = 'crew_id';
            crewIdInput.value = '{{ crew.id if crew else "" }}';
            
            const redirectInput = document.createElement('input');
            redirectInput.type = 'hidden';
            redirectInput.name = 'redirect_to';
            redirectInput.value = 'preferences';
            
            form.appendChild(memberIdInput);
            form.appendChild(crewIdInput);
            form.appendChild(redirectInput);
            document.body.appendChild(form);
            form.submit();
        }
    }

    // Delete all crew members
    function deleteAllMembers() {
        const memberCount = {{ crew_members|length }};
        if (memberCount === 0) {
            alert('No crew members to delete.');
            return;
        }
        
        if (confirm(`Are you sure you want to delete ALL ${memberCount} crew members? This will also delete all their program scores and cannot be undone.`)) {
            // Create a form to submit the delete all request
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{{ url_for("delete_all_members") }}';
            
            const crewIdInput = document.createElement('input');
            crewIdInput.type = 'hidden';
            crewIdInput.name = 'crew_id';
            crewIdInput.value = '{{ crew.id if crew else "" }}';
            
            form.appendChild(crewIdInput);
            document.body.appendChild(form);
            form.submit();
        }
    }

    // Handle trek type change
    function handleTrekTypeChange() {
        const trekType = document.getElementById('trek_type').value;
        
        // Show a brief notification about the change
        const notification = document.createElement('div');
        notification.className = 'alert alert-info alert-dismissible fade show position-fixed';
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; max-width: 400px;';
        
        // Build notification content safely
        const icon = document.createElement('i');
        icon.className = 'fas fa-info-circle';
        notification.appendChild(icon);
        
        const text1 = document.createTextNode(' Trek type changed to ');
        notification.appendChild(text1);
        
        const strong = document.createElement('strong');
        strong.textContent = trekType;
        notification.appendChild(strong);
        
        const text2 = document.createTextNode('. Save your preferences to apply this change.');
        notification.appendChild(text2);
        
        const btnClose = document.createElement('button');
        btnClose.type = 'button';
        btnClose.className = 'btn-close';
        btnClose.setAttribute('data-bs-dismiss', 'alert');
        notification.appendChild(btnClose);
        
        document.body.appendChild(notification);
        
        // Auto-dismiss after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 5000);
    }
</script>
{% endblock %}